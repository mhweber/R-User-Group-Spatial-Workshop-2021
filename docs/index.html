<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Spatial Data and Analysis in R</title>
  <meta name="description" content="This is a draft of material for the R Spatial Workshop at the EPA R User Group Meeting in September 2021." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Spatial Data and Analysis in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a draft of material for the R Spatial Workshop at the EPA R User Group Meeting in September 2021." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spatial Data and Analysis in R" />
  
  <meta name="twitter:description" content="This is a draft of material for the R Spatial Workshop at the EPA R User Group Meeting in September 2021." />
  

<meta name="author" content="Marc Weber" />


<meta name="date" content="2021-09-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="reading-in-spatial-data.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script>
    $(document).ready(function () {
        process_solutions();
    });
    function process_solutions() {
        $("div.section[id^='solution']").each(function(i) {
        var soln_wrapper_id = "cvxr_ex_" + i;
        var solution_id = $(this).attr('id');
        var button = $("<button onclick=\"toggle_solution('" + soln_wrapper_id + "')\">Show/Hide</button>");
        var new_div = $("<div id='" + soln_wrapper_id + "' class='solution' style='display: none;'></div>");
        var h = $(this).first();
        var others = $(this).children().slice(1);
        $(others).each(function() {
            $(this).appendTo($(new_div));
        });
        $(button).insertAfter($(h));
        $(new_div).insertAfter($(button));
        })
    }
    function toggle_solution(el_id) {
      $("#" + el_id).toggle();
    } 
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/lesson.css" type="text/css" />
<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data and Analysis in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#workshop-agenda"><i class="fa fa-check"></i><b>1.1</b> Workshop agenda</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workshop-packages-and-data"><i class="fa fa-check"></i><b>1.2</b> Workshop Packages and Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#downloading-content-via-github"><i class="fa fa-check"></i><b>1.3</b> Downloading content via Github</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#using-rmarkdown-and-rstudio"><i class="fa fa-check"></i><b>1.4</b> Using RMarkdown and RStudio</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>1.5</b> Overview</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#r-basics-review"><i class="fa fa-check"></i><b>1.6</b> R Basics Review</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#spatial-data-in-r"><i class="fa fa-check"></i><b>1.7</b> Spatial Data in R</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#exercise"><i class="fa fa-check"></i><b>1.7.1</b> Exercise</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#solution"><i class="fa fa-check"></i><b>1.7.2</b> Solution</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#r-spatial-package-landscape"><i class="fa fa-check"></i><b>1.7.3</b> R Spatial Package Landscape</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#exercise-1"><i class="fa fa-check"></i><b>1.7.4</b> Exercise</a></li>
<li class="chapter" data-level="1.7.5" data-path="index.html"><a href="index.html#solution-1"><i class="fa fa-check"></i><b>1.7.5</b> Solution</a></li>
<li class="chapter" data-level="1.7.6" data-path="index.html"><a href="index.html#primary-r-spatial-packages"><i class="fa fa-check"></i><b>1.7.6</b> Primary R spatial packages</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#quick-examples"><i class="fa fa-check"></i><b>1.8</b> Quick examples</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="index.html"><a href="index.html#geocoding-example-with-tmaptools-using-open-street-map"><i class="fa fa-check"></i><b>1.8.1</b> Geocoding example with tmaptools using open street map</a></li>
<li class="chapter" data-level="1.8.2" data-path="index.html"><a href="index.html#exercise-2"><i class="fa fa-check"></i><b>1.8.2</b> Exercise</a></li>
<li class="chapter" data-level="1.8.3" data-path="index.html"><a href="index.html#solution-2"><i class="fa fa-check"></i><b>1.8.3</b> Solution</a></li>
<li class="chapter" data-level="1.8.4" data-path="index.html"><a href="index.html#choropleth-map"><i class="fa fa-check"></i><b>1.8.4</b> Choropleth map</a></li>
<li class="chapter" data-level="1.8.5" data-path="index.html"><a href="index.html#interactive-mapping"><i class="fa fa-check"></i><b>1.8.5</b> Interactive mapping</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html"><i class="fa fa-check"></i><b>2</b> Reading in Spatial Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#reading-in-vector-data"><i class="fa fa-check"></i><b>2.1</b> Reading in vector data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#shapefiles"><i class="fa fa-check"></i><b>2.1.1</b> Shapefiles</a></li>
<li class="chapter" data-level="2.1.2" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#geodatabases"><i class="fa fa-check"></i><b>2.1.2</b> Geodatabases</a></li>
<li class="chapter" data-level="2.1.3" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#geopackages"><i class="fa fa-check"></i><b>2.1.3</b> Geopackages</a></li>
<li class="chapter" data-level="2.1.4" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#open-spatial-data-sources"><i class="fa fa-check"></i><b>2.1.4</b> Open spatial data sources</a></li>
<li class="chapter" data-level="2.1.5" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#spatial-data-from-r-packages"><i class="fa fa-check"></i><b>2.1.5</b> Spatial data from R packages</a></li>
<li class="chapter" data-level="2.1.6" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#read-in-openstreetmap-data"><i class="fa fa-check"></i><b>2.1.6</b> Read in OpenStreetMap data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#raster-data"><i class="fa fa-check"></i><b>2.2</b> Raster data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#raster-package"><i class="fa fa-check"></i><b>2.2.1</b> <code>raster</code> package</a></li>
<li class="chapter" data-level="2.2.2" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#terra-package"><i class="fa fa-check"></i><b>2.2.2</b> <code>terra</code> package</a></li>
<li class="chapter" data-level="2.2.3" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#stars-package"><i class="fa fa-check"></i><b>2.2.3</b> <code>stars</code> package</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="reading-in-spatial-data.html"><a href="reading-in-spatial-data.html#convert-flat-files-to-spatial"><i class="fa fa-check"></i><b>2.3</b> Convert flat files to spatial</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="coordinate-reference-systems.html"><a href="coordinate-reference-systems.html"><i class="fa fa-check"></i><b>3</b> Coordinate reference systems</a>
<ul>
<li class="chapter" data-level="3.1" data-path="coordinate-reference-systems.html"><a href="coordinate-reference-systems.html#lesson-objectives"><i class="fa fa-check"></i><b>3.1</b> Lesson Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="coordinate-reference-systems.html"><a href="coordinate-reference-systems.html#why-you-need-to-know-about-crs-working-with-spatial-data-in-r"><i class="fa fa-check"></i><b>3.2</b> Why you need to know about CRS working with spatial data in R:</a></li>
<li class="chapter" data-level="3.3" data-path="coordinate-reference-systems.html"><a href="coordinate-reference-systems.html#changes-to-crs-recently-in-r-in-sf"><i class="fa fa-check"></i><b>3.3</b> Changes to CRS recently in R in <code>sf</code></a></li>
<li class="chapter" data-level="3.4" data-path="coordinate-reference-systems.html"><a href="coordinate-reference-systems.html#projected-coordinate-systems"><i class="fa fa-check"></i><b>3.4</b> Projected coordinate systems</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vector-data-with-sf.html"><a href="vector-data-with-sf.html"><i class="fa fa-check"></i><b>4</b> Vector data with <code>sf</code></a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="vector-data-with-sf.html"><a href="vector-data-with-sf.html#sf-methods"><i class="fa fa-check"></i><b>4.0.1</b> <code>sf</code> Methods</a></li>
<li class="chapter" data-level="4.0.2" data-path="vector-data-with-sf.html"><a href="vector-data-with-sf.html#exploring-sf"><i class="fa fa-check"></i><b>4.0.2</b> Exploring <code>sf</code></a></li>
<li class="chapter" data-level="4.1" data-path="vector-data-with-sf.html"><a href="vector-data-with-sf.html#units-in-sf"><i class="fa fa-check"></i><b>4.1</b> Units in <code>sf</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster-data-1.html"><a href="raster-data-1.html"><i class="fa fa-check"></i><b>5</b> Raster data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="raster-data-1.html"><a href="raster-data-1.html#raster-data-with-terra"><i class="fa fa-check"></i><b>5.1</b> Raster data with <code>terra</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="raster-data-1.html"><a href="raster-data-1.html#exercise-5"><i class="fa fa-check"></i><b>5.1.1</b> Exercise</a></li>
<li class="chapter" data-level="5.1.2" data-path="raster-data-1.html"><a href="raster-data-1.html#solution-5"><i class="fa fa-check"></i><b>5.1.2</b> Solution</a></li>
<li class="chapter" data-level="5.1.3" data-path="raster-data-1.html"><a href="raster-data-1.html#manipulating-raster-objects"><i class="fa fa-check"></i><b>5.1.3</b> Manipulating <code>raster</code> objects</a></li>
<li class="chapter" data-level="5.1.4" data-path="raster-data-1.html"><a href="raster-data-1.html#reading-existing-rasters-on-disk"><i class="fa fa-check"></i><b>5.1.4</b> Reading existing rasters on disk</a></li>
<li class="chapter" data-level="5.1.5" data-path="raster-data-1.html"><a href="raster-data-1.html#multiband-rasters"><i class="fa fa-check"></i><b>5.1.5</b> Multiband rasters</a></li>
<li class="chapter" data-level="5.1.6" data-path="raster-data-1.html"><a href="raster-data-1.html#plotting-rasters-and-vectors-with-tmap"><i class="fa fa-check"></i><b>5.1.6</b> Plotting rasters and vectors with tmap</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raster-data-1.html"><a href="raster-data-1.html#raster-data-with-stars"><i class="fa fa-check"></i><b>5.2</b> Raster data with <code>stars</code></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="raster-data-1.html"><a href="raster-data-1.html#read-a-satellite-image"><i class="fa fa-check"></i><b>5.2.1</b> Read a satellite image</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="raster-data-1.html"><a href="raster-data-1.html#raster-operations"><i class="fa fa-check"></i><b>5.3</b> Raster Operations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="raster-data-1.html"><a href="raster-data-1.html#projecting"><i class="fa fa-check"></i><b>5.3.1</b> Projecting</a></li>
<li class="chapter" data-level="5.3.2" data-path="raster-data-1.html"><a href="raster-data-1.html#cropping"><i class="fa fa-check"></i><b>5.3.2</b> Cropping</a></li>
<li class="chapter" data-level="5.3.3" data-path="raster-data-1.html"><a href="raster-data-1.html#map-algebra"><i class="fa fa-check"></i><b>5.3.3</b> Map Algebra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="geoprocessing.html"><a href="geoprocessing.html"><i class="fa fa-check"></i><b>6</b> Geoprocessing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="geoprocessing.html"><a href="geoprocessing.html#lesson-goals"><i class="fa fa-check"></i><b>6.1</b> Lesson Goals</a></li>
<li class="chapter" data-level="6.2" data-path="geoprocessing.html"><a href="geoprocessing.html#spatial-subsetting"><i class="fa fa-check"></i><b>6.2</b> Spatial Subsetting</a></li>
<li class="chapter" data-level="6.3" data-path="geoprocessing.html"><a href="geoprocessing.html#spatial-join"><i class="fa fa-check"></i><b>6.3</b> Spatial Join</a></li>
<li class="chapter" data-level="6.4" data-path="geoprocessing.html"><a href="geoprocessing.html#dissolve"><i class="fa fa-check"></i><b>6.4</b> Dissolve</a></li>
<li class="chapter" data-level="6.5" data-path="geoprocessing.html"><a href="geoprocessing.html#spatial-overlap"><i class="fa fa-check"></i><b>6.5</b> Spatial Overlap</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="geoprocessing.html"><a href="geoprocessing.html#next-well-create-a-dummy-spatial-polygon-file-to-compare-area-with-using-the-rmapshaper-package-to-simplify-the-border-of-the-pdx-metropolitan-polygon"><i class="fa fa-check"></i><b>6.5.1</b> Next we’ll create a dummy spatial polygon file to compare area with using the <code>rmapshaper</code> package to simplify the border of the PDX metropolitan polygon</a></li>
<li class="chapter" data-level="6.5.2" data-path="geoprocessing.html"><a href="geoprocessing.html#then-we-can-overlay-polygons-in-ggplot-to-see-how-similar-they-are-showing-the-original-census-pdx-metropolitan-area-in-green-and-new-simplified-polygon-in-red"><i class="fa fa-check"></i><b>6.5.2</b> Then we can overlay polygons in ggplot to see how similar they are, showing the original census PDX metropolitan area in green, and new simplified polygon in red</a></li>
<li class="chapter" data-level="6.5.3" data-path="geoprocessing.html"><a href="geoprocessing.html#now-that-we-have-an-original-and-simplified-polygon-to-compare-the-process-we-want-to-use-is"><i class="fa fa-check"></i><b>6.5.3</b> Now that we have an original and simplified polygon to compare, the process we want to use is:</a></li>
<li class="chapter" data-level="6.5.4" data-path="geoprocessing.html"><a href="geoprocessing.html#exercise-8"><i class="fa fa-check"></i><b>6.5.4</b> Exercise</a></li>
<li class="chapter" data-level="6.5.5" data-path="geoprocessing.html"><a href="geoprocessing.html#solution-8"><i class="fa fa-check"></i><b>6.5.5</b> Solution</a></li>
<li class="chapter" data-level="6.5.6" data-path="geoprocessing.html"><a href="geoprocessing.html#exercise-9"><i class="fa fa-check"></i><b>6.5.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="geoprocessing.html"><a href="geoprocessing.html#deriving-data-for-a-sites-or-a-watershed"><i class="fa fa-check"></i><b>6.6</b> Deriving data for a sites or a watershed</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="geoprocessing.html"><a href="geoprocessing.html#extract-using-sites"><i class="fa fa-check"></i><b>6.6.1</b> Extract using sites</a></li>
<li class="chapter" data-level="6.6.2" data-path="geoprocessing.html"><a href="geoprocessing.html#river-reaches-and-basin"><i class="fa fa-check"></i><b>6.6.2</b> River reaches and basin</a></li>
<li class="chapter" data-level="6.6.3" data-path="geoprocessing.html"><a href="geoprocessing.html#streamcat-data-for-watershed"><i class="fa fa-check"></i><b>6.6.3</b> StreamCat data for watershed</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="geoprocessing.html"><a href="geoprocessing.html#extract"><i class="fa fa-check"></i><b>6.7</b> Extract</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="visualizing-spatial-data.html"><a href="visualizing-spatial-data.html"><i class="fa fa-check"></i><b>7</b> Visualizing Spatial Data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="visualizing-spatial-data.html"><a href="visualizing-spatial-data.html#lesson-goals-1"><i class="fa fa-check"></i><b>7.1</b> Lesson Goals</a></li>
<li class="chapter" data-level="7.2" data-path="visualizing-spatial-data.html"><a href="visualizing-spatial-data.html#chorpleths-with-tmap"><i class="fa fa-check"></i><b>7.2</b> Chorpleths with <code>tmap</code></a></li>
<li class="chapter" data-level="7.3" data-path="visualizing-spatial-data.html"><a href="visualizing-spatial-data.html#leaflet"><i class="fa fa-check"></i><b>7.3</b> <code>leaflet</code></a></li>
<li class="chapter" data-level="7.4" data-path="visualizing-spatial-data.html"><a href="visualizing-spatial-data.html#mapview"><i class="fa fa-check"></i><b>7.4</b> <code>mapview</code></a></li>
<li class="chapter" data-level="7.5" data-path="visualizing-spatial-data.html"><a href="visualizing-spatial-data.html#visualize-site-data"><i class="fa fa-check"></i><b>7.5</b> Visualize site data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="extensions-to-work-with-gis-software-in-r.html"><a href="extensions-to-work-with-gis-software-in-r.html"><i class="fa fa-check"></i><b>8</b> Extensions to work with GIS software in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="extensions-to-work-with-gis-software-in-r.html"><a href="extensions-to-work-with-gis-software-in-r.html#rqgis"><i class="fa fa-check"></i><b>8.1</b> RQGIS</a></li>
<li class="chapter" data-level="8.2" data-path="extensions-to-work-with-gis-software-in-r.html"><a href="extensions-to-work-with-gis-software-in-r.html#r-arcgis-bridge"><i class="fa fa-check"></i><b>8.2</b> R-ArcGIS bridge</a></li>
<li class="chapter" data-level="8.3" data-path="extensions-to-work-with-gis-software-in-r.html"><a href="extensions-to-work-with-gis-software-in-r.html#accessing-python-toolbox-using-reticulate"><i class="fa fa-check"></i><b>8.3</b> Accessing Python toolbox using reticulate</a></li>
<li class="chapter" data-level="8.4" data-path="extensions-to-work-with-gis-software-in-r.html"><a href="extensions-to-work-with-gis-software-in-r.html#r-whitebox-tools"><i class="fa fa-check"></i><b>8.4</b> R Whitebox Tools</a></li>
<li class="chapter" data-level="8.5" data-path="extensions-to-work-with-gis-software-in-r.html"><a href="extensions-to-work-with-gis-software-in-r.html#rgee"><i class="fa fa-check"></i><b>8.5</b> rgee</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a>
<ul>
<li class="chapter" data-level="9.1" data-path="references.html"><a href="references.html#r-spatial-resources"><i class="fa fa-check"></i><b>9.1</b> R Spatial Resources</a></li>
<li class="chapter" data-level="9.2" data-path="references.html"><a href="references.html#r-vector-processing-simple-features-resources"><i class="fa fa-check"></i><b>9.2</b> R Vector Processing / Simple Features Resources</a></li>
<li class="chapter" data-level="9.3" data-path="references.html"><a href="references.html#r-raster-resources"><i class="fa fa-check"></i><b>9.3</b> R Raster Resources</a></li>
<li class="chapter" data-level="9.4" data-path="references.html"><a href="references.html#r-mapping-resources"><i class="fa fa-check"></i><b>9.4</b> R Mapping Resources</a></li>
<li class="chapter" data-level="9.5" data-path="references.html"><a href="references.html#general-r-resources"><i class="fa fa-check"></i><b>9.5</b> General R Resources</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/mhweber/R-User-Group-Spatial-Workshop-2021" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data and Analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Spatial Data and Analysis in R</h1>
<p class="author"><em>Marc Weber</em></p>
<p class="date"><em>2021-09-22</em></p>
</div>
<div id="intro" class="section level1" number="1">
<h1><span class="header-section-number">Chapter 1</span> Introduction</h1>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="images/WordCloud.png" alt="A bit about me" width="150%" />
<p class="caption">
Figure 1.1: A bit about me
</p>
</div>
<div id="workshop-agenda" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Workshop agenda</h2>
<ul>
<li><p>1:00pm - 1:30pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/index.html">Intro and quick intro to R spatial objects and methods</a></p></li>
<li><p>1:30pm - 1:55pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/reading-in-spatial-data.html">Getting spatial data into R</a></p></li>
<li><p>1:55: 2:00 Break</p></li>
<li><p>2:00pm - 2:30pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/index.html#spatial-data-in-r">Understanding vector and raster data in R and some example workflows</a></p></li>
<li><p>2:30: 2:45 Break</p></li>
<li><p>2:45pm - 3:00pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/coordinate-reference-systems.html">Understanding coordinate reference systems (CRS)</a></p></li>
<li><p>3:00pm - 3:25pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/vector-data-with-sf.html">Vector data with sf</a></p></li>
<li><p>3:25pm - 3:33pm Break</p></li>
<li><p>3:30pm - 4:30pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/raster-data.html">Raster data</a></p></li>
<li><p>4:30pm - 4:30pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/geoprocessing.html">Geoprocessing</a></p></li>
<li><p>4:30pm - 5:00pm EDT: <a href="https://mhweber.github.io/R-User-Group-Spatial-Workshop-2021/visualizing-spatial-data.html">Learning ways to map and visualize spatial data</a></p></li>
<li><p>Along the way we’ll look at:</p>
<ul>
<li>Select <code>tidyverse</code> packages and syntax, i.e. <code>ggplot2</code>, <code>dplyr</code>, <code>readr</code>, <code>tidyr</code>, the pipe operator %&gt;%</li>
<li>Working with vector and raster data in R</li>
</ul></li>
<li><p>If this is all new, don’t sweat it - google things, we’ll answer questions as we go</p></li>
<li><p>There is no expectation of experience with spatial analysis in R - if you already have some experience, you are sure to pick up new tricks - if you don’t, we’ll cover the basics</p></li>
<li><p>We have a limited time to cover a very broad topic, so I’ll move quickly - ask questions as they come up, but if you get lost on steps we’ll have time for discussion at the end and material will be available to peruse at your own speed later.</p></li>
</ul>
</div>
<div id="workshop-packages-and-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Workshop Packages and Data</h2>
<ul>
<li>Packages you need installed</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="index.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>) </span>
<span id="cb1-2"><a href="index.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb1-3"><a href="index.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;raster&quot;</span>)</span>
<span id="cb1-4"><a href="index.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1-5"><a href="index.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;stars&quot;</span>)</span>
<span id="cb1-6"><a href="index.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tmap&quot;</span>)</span>
<span id="cb1-7"><a href="index.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tmaptools&quot;</span>)</span>
<span id="cb1-8"><a href="index.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-9"><a href="index.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb1-10"><a href="index.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;palmerpenguins&quot;</span>)</span>
<span id="cb1-11"><a href="index.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tigris&quot;</span>)</span>
<span id="cb1-12"><a href="index.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tibble&quot;</span>)</span>
<span id="cb1-13"><a href="index.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rgdal&quot;</span>)</span>
<span id="cb1-14"><a href="index.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;leaflet&quot;</span>)</span>
<span id="cb1-15"><a href="index.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;mapview&quot;</span>)</span>
<span id="cb1-16"><a href="index.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;terra&quot;</span>)</span>
<span id="cb1-17"><a href="index.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;spDataLarge&quot;</span>)</span>
<span id="cb1-18"><a href="index.html#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-19"><a href="index.html#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">&quot;mhweber/Rspatialworkshop&quot;</span>)</span>
<span id="cb1-20"><a href="index.html#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rmapshaper&quot;</span>)</span></code></pre></div>
</div>
<div id="downloading-content-via-github" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Downloading content via Github</h2>
<ul>
<li>From <a href="https://github.com/mhweber/R-User-Group-Spatial-Workshop-2021">the workshop GitHub repository</a> clone the repository by <a href="https://github.com/mhweber/R-User-Group-Spatial-Workshop-2021.git">copying the clone link</a></li>
<li>If you’re not familiar with git and GitHub, simply choose to <a href="https://github.com/mhweber/R-User-Group-Spatial-Workshop-2021/archive/refs/heads/master.zip">download the zip file</a> to have all the material locally</li>
</ul>
</div>
<div id="using-rmarkdown-and-rstudio" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Using RMarkdown and RStudio</h2>
<ul>
<li>R Markdown allows for reproducible reporting from R</li>
<li>You write your document in markdown and embed executable code chunks using the knitr syntax</li>
<li>You can update your document at any time by re-knitting the code chunks and convert your document to a number of formats (i.e. html, pdf, word documents)</li>
<li>We will assume everyone in the workshop is familiar with using RStudio</li>
</ul>
</div>
<div id="overview" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Overview</h2>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="images/History%20of%20R.png" alt="History of R" width="150%" />
<p class="caption">
Figure 1.2: History of R
</p>
</div>
<p>Why use R for spatial analysis?</p>
<ul>
<li>R is lightweight, free, open-source and cross-platform</li>
<li>Works with contributed packages - currently 18,188 - extensibility</li>
<li>Automation and recording of workflow (reproducibility)</li>
<li>Optimized work flow - data manipulation, analysis and visualization all in one place</li>
<li>R does not alter underlying data - manipulation and visualization in memory</li>
<li>R is great for repetetive graphics</li>
<li>R is great for integrating different aspects of analysis - spatial and statistical analysis in one environment</li>
<li>Leverage statistical power of R (i.e. modeling spatial data, data visualization, statistical exploration)</li>
<li>Can handle vector and raster data, as well as work with spatial databases and pretty much any data format spatial data comes in</li>
<li>R’s GIS capabilities growing rapidly right now - new packages added monthly - currently about 275 spatial packages (depending on how you categorize)</li>
</ul>
<p>Some drawbacks to using R for GIS work</p>
<ul>
<li>R not as good for interactive use as desktop GIS applications like ArcGIS or QGIS (i.e. editing features, panning, zooming, and analysis on selected subsets of features)</li>
<li>Explicit coordinate system handling by the user, no on-the-fly projection support</li>
<li>In memory analysis does not scale well with large GIS vector and tabular data</li>
<li>Steep learning curve</li>
<li>Up to you to find packages to do what you need - help not always great</li>
</ul>
</div>
<div id="r-basics-review" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> R Basics Review</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="index.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>Which should return something like:</p>
<pre><code>[1] &quot;/home/marc/GitProjects/AWRA_GIS_R_Workshop&quot;</code></pre>
<p>To see what is in the directory:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="index.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;_after_body.html&quot;                        
##  [2] &quot;_book&quot;                                   
##  [3] &quot;_bookdown.yml&quot;                           
##  [4] &quot;_bookdown_files&quot;                         
##  [5] &quot;_output.yml&quot;                             
##  [6] &quot;02-importing.Rmd&quot;                        
##  [7] &quot;03-crs.Rmd&quot;                              
##  [8] &quot;04-vector.Rmd&quot;                           
##  [9] &quot;05-raster.Rmd&quot;                           
## [10] &quot;06-geoprocessing.Rmd&quot;                    
## [11] &quot;07-visualization.Rmd&quot;                    
## [12] &quot;08-extensions.Rmd&quot;                       
## [13] &quot;09-references.Rmd&quot;                       
## [14] &quot;book.bib&quot;                                
## [15] &quot;citylim_2017.CPG&quot;                        
## [16] &quot;citylim_2017.dbf&quot;                        
## [17] &quot;citylim_2017.json&quot;                       
## [18] &quot;citylim_2017.prj&quot;                        
## [19] &quot;citylim_2017.shp&quot;                        
## [20] &quot;citylim_2017.shp.xml&quot;                    
## [21] &quot;citylim_2017.shx&quot;                        
## [22] &quot;citylim_2017.xml&quot;                        
## [23] &quot;citylim_2017.zip&quot;                        
## [24] &quot;css&quot;                                     
## [25] &quot;docs&quot;                                    
## [26] &quot;EXTRACTIONS&quot;                             
## [27] &quot;gadm36_USA_2_sp.rds&quot;                     
## [28] &quot;header.html&quot;                             
## [29] &quot;images&quot;                                  
## [30] &quot;index.Rmd&quot;                               
## [31] &quot;intro.txt&quot;                               
## [32] &quot;js&quot;                                      
## [33] &quot;OregonStateParks.zip&quot;                    
## [34] &quot;OregonStateParks_20181010.gdb&quot;           
## [35] &quot;packages.bib&quot;                            
## [36] &quot;preamble.tex&quot;                            
## [37] &quot;R-User-Group-Spatial-Workshop-2021.Rmd&quot;  
## [38] &quot;R-User-Group-Spatial-Workshop-2021.Rproj&quot;
## [39] &quot;R-User-Group-Spatial-Workshop-2021_files&quot;
## [40] &quot;RAW&quot;                                     
## [41] &quot;README.md&quot;                               
## [42] &quot;readme.txt&quot;                              
## [43] &quot;srtm_12_04.hdr&quot;                          
## [44] &quot;srtm_12_04.tfw&quot;                          
## [45] &quot;srtm_12_04.tif&quot;                          
## [46] &quot;state_county_boundary.zip&quot;               
## [47] &quot;timestamps&quot;</code></pre>
<p>To establish a different directory:</p>
<pre><code>setwd(&quot;/home/marc/GitProjects&quot;)</code></pre>
<div id="terminology-data-structures" class="section level4" number="1.6.0.1">
<h4><span class="header-section-number">1.6.0.1</span> <strong>Terminology: data structures</strong></h4>
<p>R is an interpreted language (access through a command-line interpreter) with a number of data structures (vectors, matrices, arrays, data frames, lists) and extensible objects (regression models, time-series, geospatial coordinates) and supports procedural programming with functions.</p>
<p>To learn about objects, become friends with the built-in <code>class</code> and <code>str</code> functions. Let’s explore a new dataset - <a href="https://github.com/allisonhorst/palmerpenguins">palmerpenguins</a> - recently developed by Allison Horst as an alternative to the old R standby <code>iris</code> dataset:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="index.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb7-2"><a href="index.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="index.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(penguins)</span></code></pre></div>
<pre><code>## tibble [344 x 8] (S3: tbl_df/tbl/data.frame)
##  $ species          : Factor w/ 3 levels &quot;Adelie&quot;,&quot;Chinstrap&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ island           : Factor w/ 3 levels &quot;Biscoe&quot;,&quot;Dream&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...
##  $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...
##  $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...
##  $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...
##  $ sex              : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 1 NA 1 2 1 2 NA NA ...
##  $ year             : int [1:344] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...</code></pre>
<p><code>penguins</code> is a <a href="https://tibble.tidyverse.org/">tibble</a>, which is a new <code>tidyverse</code> spin on <code>data frames</code>, and was created as a new alternative to the <code>iris</code> data set that has been used extensively for beginning tutorials on learning R. Data frames consist of rows of observations on columns of values for variables of interest - they are one of the fundamental and most important data structures in R. <code>tibbles</code> make a few improvements / changes to <code>data frames</code> such as:</p>
<ul>
<li>Never converting strings to factors</li>
<li>Never creating row names</li>
<li>Updated print method that only shows first 10 rows, just the columns that fit on the screen, and the type of each column (just as we get using <code>str</code>)</li>
</ul>
<p>We can easily convert objects from <code>tibble</code> to <code>data frame</code> and vice versa:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="index.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb11-2"><a href="index.html#cb11-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(penguins)</span>
<span id="cb11-3"><a href="index.html#cb11-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(penguins)</span></code></pre></div>
<p>But as we see in the result of <code>str(penguins)</code> above, following the information that <code>penguins</code> is a <code>tibble</code> with 344 observations of 8 variables, we get information on each of the variables, in this case that 2 are numeric, 2 are integers, and 3 are factors - factors encode categorical variables - and <code>str</code> gives us the number of levels in each factor.</p>
<p>First off, R has several main data types:</p>
<ul>
<li>logical</li>
<li>integer</li>
<li>double</li>
<li>complex</li>
<li>character</li>
<li>raw</li>
<li>list</li>
<li>NULL</li>
<li>closure (function)</li>
<li>special</li>
<li>builtin (basic functions and operators)</li>
<li>environment</li>
<li>S4 (some S4 objects)</li>
<li>others you won’t run into at user level</li>
</ul>
<p>We can ask what data type something is using <code>typeof</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="index.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="index.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(penguins<span class="sc">$</span>bill_length_mm)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="index.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(penguins<span class="sc">$</span>species)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>We see a couple interesting things here - <code>penguins</code>, which we just said is a <code>tibble</code>, is a data type of <code>list</code>. <code>bill_length_mm</code> is data type <code>double</code>, and in <code>str(penguins)</code> we saw it was numeric - that makes sense - but we see that <code>species</code> is data type <code>integer</code>, and in <code>str(penguins)</code> we were told this variable was a factor with three levels. What’s going on here?</p>
<p>First off, <code>class</code> refers to the abstract type of an object in R, whereas <code>typeof</code> or <code>mode</code> refer to how an object is stored in memory. So <code>penguins</code> is an object of class <code>tibble</code>, but it is stored in memory as a list (i.e. each column is an item in a list). Note that this allows tibbles and data frames to have columns of different classes, whereas a matrix needs to be all of the same mode.</p>
<p>For our <code>species</code> column, we see it’s <code>mode</code> is numeric, it’s <code>typeof</code> is <code>integer</code>, and it’s class is <code>factor</code>. Nominal variables in R are treated as a vector of integers 1:k, where k is the number of unique values of that nominal variable and a mapping of the character strings to these integer values.</p>
<p>This allows us to quickly see see all the unique values of a particular nominal variable or quickly re-asign a level of a nominal variable to a new value - remember, everything in R is in memory, so don’t worry about tweaking the data!</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="index.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(penguins<span class="sc">$</span>species)</span></code></pre></div>
<pre><code>## [1] &quot;Adelie&quot;    &quot;Chinstrap&quot; &quot;Gentoo&quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="index.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(penguins<span class="sc">$</span>species)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&#39;adeliae&#39;</span></span></code></pre></div>
<p>See if you can explain how that re-asignment we just did worked.</p>
<p>To access particular columns in a <code>tibble</code> or <code>data frame</code>, as we saw above, we use the <code>$</code> operator. We can see the value of <code>species</code> for each observation in <code>penguins</code> as well as listing of all levels of the variable by running:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="index.html#cb21-1" aria-hidden="true" tabindex="-1"></a>penguins<span class="sc">$</span>species</span></code></pre></div>
<pre><code>##   [1] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##   [8] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [15] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [22] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [29] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [36] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [43] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [50] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [57] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [64] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [71] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [78] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [85] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [92] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [99] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [106] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [113] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [120] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [127] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [134] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [141] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [148] adeliae   adeliae   adeliae   adeliae   adeliae   Gentoo    Gentoo   
## [155] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [162] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [169] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [176] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [183] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [190] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [197] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [204] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [211] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [218] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [225] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [232] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [239] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [246] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [253] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [260] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [267] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [274] Gentoo    Gentoo    Gentoo    Chinstrap Chinstrap Chinstrap Chinstrap
## [281] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [288] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [295] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [302] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [309] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [316] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [323] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [330] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [337] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [344] Chinstrap
## Levels: adeliae Chinstrap Gentoo</code></pre>
<p>To access particular columns or rows of a data frame, we use indexing:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="index.html#cb23-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="dv">1</span>,<span class="dv">3</span>] <span class="co"># the 1st row and the 3rd column</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   bill_length_mm
##            &lt;dbl&gt;
## 1           39.1</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="index.html#cb25-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="dv">4</span>,<span class="dv">1</span>] <span class="co"># the 4th row and the 1st column</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   species
##   &lt;fct&gt;  
## 1 adeliae</code></pre>
<p>A handy function is <code>names</code>, which you can use to get or to set data frame variable names:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="index.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;species&quot;           &quot;island&quot;            &quot;bill_length_mm&quot;   
## [4] &quot;bill_depth_mm&quot;     &quot;flipper_length_mm&quot; &quot;body_mass_g&quot;      
## [7] &quot;sex&quot;               &quot;year&quot;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="index.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(penguins)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&#39;Bill Length&#39;</span></span></code></pre></div>
<p>Explain what this last line did</p>
<p>A little example of tidy evaluation and piping to do the same thing - we’ll go into more:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="index.html#cb30-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="index.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&#39;Bill_Length&#39;</span><span class="ot">=</span><span class="st">&#39;Bill Length&#39;</span>)</span>
<span id="cb30-3"><a href="index.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check it</span></span>
<span id="cb30-4"><a href="index.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;species&quot;           &quot;island&quot;            &quot;Bill_Length&quot;      
## [4] &quot;bill_depth_mm&quot;     &quot;flipper_length_mm&quot; &quot;body_mass_g&quot;      
## [7] &quot;sex&quot;               &quot;year&quot;</code></pre>
</div>
<div id="review-of-classes-and-methods" class="section level4" number="1.6.0.2">
<h4><span class="header-section-number">1.6.0.2</span> <strong>Review of Classes and Methods</strong></h4>
<ul>
<li>Class: object types
<ul>
<li><code>class()</code>: gives the class type</li>
<li><code>typeof()</code>: information on how the object is stored</li>
<li><code>str()</code>: how the object is structured</li>
</ul></li>
<li>Method: generic functions
<ul>
<li><code>print()</code></li>
<li><code>plot()</code></li>
<li><code>summary</code>()</li>
</ul></li>
</ul>
</div>
</div>
<div id="spatial-data-in-r" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Spatial Data in R</h2>
<p>We can represent spatial data as discrete locations (points, lines or polygons) or as a grid of values rendered on a map as pixels. We typically represent the former type of data (discrete locations) as <em>vector</em> data, with an associated geometry or shape, and some attributes with information about the locations. Examples are:</p>
<ul>
<li>state boundaries with state name and population</li>
<li>rivers with their flow volume and names</li>
<li>polygons of watersheds with their names and associated landscape information</li>
</ul>
<p>We represent the latter type of data (a grid of values as pixels) with <em>rasters</em>. Rasters can be continous (i.e. elevation, precipitation, atmospheric deposition) or they can be categorical (i.e. land use, soil type) - they can also be image based rasters, and they can be single band or multi-band.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-17"></span>
<img src="images/Rasters4.png" alt="Raster Data" width="100%" />
<p class="caption">
Figure 1.3: Raster Data
</p>
</div>
<p>We will delve into working with each of these types of data in their own sections, but let’s go over how these spatial data types are handled in R briefly.</p>
<p>Basic data structures in R can represent spatial data - all we need is some vectors with location and attribute information - below we generate cites with population, add a polygon, and make a map with a legend - take a minute to run this code in your own R session and make sure you understand what each line is doing.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="index.html#cb32-1" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Ashland&#39;</span>,<span class="st">&#39;Corvallis&#39;</span>,<span class="st">&#39;Bend&#39;</span>,<span class="st">&#39;Portland&#39;</span>,<span class="st">&#39;Newport&#39;</span>)</span>
<span id="cb32-2"><a href="index.html#cb32-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">122.699</span>, <span class="sc">-</span><span class="fl">123.275</span>, <span class="sc">-</span><span class="fl">121.313</span>, <span class="sc">-</span><span class="fl">122.670</span>, <span class="sc">-</span><span class="fl">124.054</span>)</span>
<span id="cb32-3"><a href="index.html#cb32-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">42.189</span>, <span class="fl">44.57</span>, <span class="fl">44.061</span>, <span class="fl">45.523</span>, <span class="fl">44.652</span>)</span>
<span id="cb32-4"><a href="index.html#cb32-4" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20062</span>,<span class="dv">50297</span>,<span class="dv">61362</span>,<span class="dv">537557</span>,<span class="dv">9603</span>)</span>
<span id="cb32-5"><a href="index.html#cb32-5" aria-hidden="true" tabindex="-1"></a>locs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude) </span>
<span id="cb32-6"><a href="index.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(locs, <span class="at">cex=</span><span class="fu">sqrt</span>(population<span class="sc">*</span>.<span class="dv">0002</span>), <span class="at">pch=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>, </span>
<span id="cb32-7"><a href="index.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">main=</span><span class="st">&#39;Population&#39;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">124</span>,<span class="sc">-</span><span class="fl">120.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">42</span>, <span class="dv">46</span>))</span>
<span id="cb32-8"><a href="index.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(locs, cities, <span class="at">pos=</span><span class="dv">4</span>)</span>
<span id="cb32-9"><a href="index.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="index.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend</span></span>
<span id="cb32-11"><a href="index.html#cb32-11" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>, <span class="dv">100000</span>)</span>
<span id="cb32-12"><a href="index.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">3</span>)</span>
<span id="cb32-13"><a href="index.html#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span>breaks, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">pt.cex=</span><span class="dv">1</span><span class="sc">+</span>breaks<span class="sc">/</span><span class="dv">20000</span>, </span>
<span id="cb32-14"><a href="index.html#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">&#39;red&#39;</span>, <span class="at">bg=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb32-15"><a href="index.html#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="index.html#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add polygon</span></span>
<span id="cb32-17"><a href="index.html#cb32-17" aria-hidden="true" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">123.5</span>, <span class="sc">-</span><span class="fl">123.5</span>, <span class="sc">-</span><span class="fl">122.5</span>, <span class="sc">-</span><span class="fl">122.670</span>, <span class="sc">-</span><span class="dv">123</span>)</span>
<span id="cb32-18"><a href="index.html#cb32-18" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">43</span>, <span class="fl">45.5</span>, <span class="dv">44</span>, <span class="dv">43</span>, <span class="dv">43</span>)</span>
<span id="cb32-19"><a href="index.html#cb32-19" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(lon, lat)</span>
<span id="cb32-20"><a href="index.html#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(x, <span class="at">border=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb32-21"><a href="index.html#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb32-22"><a href="index.html#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="R-User-Group-Spatial-Workshop-2021_files/figure-html/basic%20spatial%20data%20structures%20vector-1.png" width="672" /></p>
<p>We can see in this toy example that numeric vectors can represent locations in R for simple mapping. Points just need to be a pair of numbers in cartesian space, and lines and polygons are just a number of these points (note that polygons are closed by having their first point coincide with last point which the polygon function in base R graphics takes care of).</p>
<p>What about raster data? A raster in essence is simply a matrix of values for raster cells</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="index.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;plot.matrix&#39;</span>)</span>
<span id="cb33-2"><a href="index.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># numeric matrix</span></span>
<span id="cb33-3"><a href="index.html#cb33-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">35</span>), <span class="at">ncol=</span><span class="dv">5</span>) <span class="co"># create a numeric matrix object</span></span>
<span id="cb33-4"><a href="index.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="index.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;matrix&quot;</span></span>
<span id="cb35-2"><a href="index.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>)) <span class="co"># adapt margins</span></span>
<span id="cb35-3"><a href="index.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span></code></pre></div>
<p><img src="R-User-Group-Spatial-Workshop-2021_files/figure-html/basic%20spatial%20data%20structures%20raster-1.png" width="672" /></p>
<p>We have a ‘raster’ of cell values in columnns and rows - but what is lacking?</p>
<p>You can do simple things with these spatial representations using basic R structures, but it breaks down quickly if you want to ask any spatial questions - for instance using the first example above, how would we figure out the nearest city to Corvallis? Or imagine the polygon is a county and we wanted to know what cities are within the county? Or how would we superimpose our cities on our raster cells? Or extract the value of a cell at the location of a city?</p>
<div id="exercise" class="section level3" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> Exercise</h3>
<p>What information do we need to properly define spatial vector data and perform spatial operations?</p>
</div>
<div id="solution" class="section level3" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> Solution</h3>
<ul>
<li>A coordinate reference system (CRS)</li>
<li>A bounding box or extent</li>
<li>Methods for storing and accessing spatial attributes of data</li>
<li>?</li>
</ul>
</div>
<div id="r-spatial-package-landscape" class="section level3" number="1.7.3">
<h3><span class="header-section-number">1.7.3</span> R Spatial Package Landscape</h3>
<p><img src="R-User-Group-Spatial-Workshop-2021_files/figure-html/spatial%20packages-1.png" width="672" /></p>
<p><code>sf</code> swamps everything! limit the y-axis
<img src="R-User-Group-Spatial-Workshop-2021_files/figure-html/spatial%20packages2-1.png" width="672" /></p>
</div>
<div id="exercise-1" class="section level3" number="1.7.4">
<h3><span class="header-section-number">1.7.4</span> Exercise</h3>
<p>How did we make this figure?</p>
<p>Look at answer below, run code in your own code editor, see if it makes sense and ask questions</p>
</div>
<div id="solution-1" class="section level3" number="1.7.5">
<h3><span class="header-section-number">1.7.5</span> Solution</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="index.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;metacran/cranlogs&quot;)</span></span>
<span id="cb36-2"><a href="index.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cranlogs, <span class="at">quietly =</span> T)</span>
<span id="cb36-3"><a href="index.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cranlogs, <span class="at">quietly =</span> T)</span>
<span id="cb36-4"><a href="index.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2, <span class="at">quietly =</span> T)</span>
<span id="cb36-5"><a href="index.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate, <span class="at">quietly =</span> T)</span>
<span id="cb36-6"><a href="index.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">quietly =</span> T)</span>
<span id="cb36-7"><a href="index.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">3</span>)</span>
<span id="cb36-8"><a href="index.html#cb36-8" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">cran_downloads</span>(<span class="at">from =</span> <span class="st">&quot;2018-01-01&quot;</span>, <span class="at">to =</span> <span class="st">&quot;2021-09-01&quot;</span>,<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;sp&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="st">&quot;raster&quot;</span>, <span class="st">&quot;tmap&quot;</span>, <span class="st">&quot;mapview&quot;</span>, <span class="st">&quot;leaflet&quot;</span>,<span class="st">&quot;ggmap&quot;</span>, <span class="st">&quot;stars&quot;</span>, <span class="st">&quot;terra&quot;</span>))</span>
<span id="cb36-9"><a href="index.html#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="index.html#cb36-10" aria-hidden="true" tabindex="-1"></a>monthly_stats <span class="ot">&lt;-</span> stats <span class="sc">%&gt;%</span> </span>
<span id="cb36-11"><a href="index.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">month=</span><span class="fu">floor_date</span>(date, <span class="st">&quot;month&quot;</span>), package) <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="index.html#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">amount=</span><span class="fu">sum</span>(count))</span>
<span id="cb36-13"><a href="index.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_stats, <span class="fu">aes</span>(<span class="at">x=</span>month, <span class="at">y=</span>amount, <span class="at">group =</span> package, <span class="at">colour =</span> package)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">scale_colour_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;R Monthly Spatial Package </span><span class="sc">\n</span><span class="st"> Downloads since 2018&quot;</span>)</span></code></pre></div>
</div>
<div id="primary-r-spatial-packages" class="section level3" number="1.7.6">
<h3><span class="header-section-number">1.7.6</span> Primary R spatial packages</h3>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="images/Prehistoric.jpg" alt="Moving on from `sp`" width="75%" />
<p class="caption">
Figure 1.4: Moving on from <code>sp</code>
</p>
</div>
<p><code>sp</code> was the core vector spatial data package in R for a number of years, and while still used and while many packages still depend on the package, we will focus entirely <code>sf</code> for working with vector data.</p>
<p>This portion of the workshop will focus primarily on the following core packages for working with spatial data in R:
- <code>sf</code> - The core package for working with vector data in R
- <code>terra</code> - The replacement package for <code>raster</code> which has been the primary spatial package for working with raster data in R
- <code>mapview</code> - this is a wrapper package for R <code>leaflet</code> package and I find simpler and more intuitive
- <code>ggolot</code> and <code>tmap</code> - static plotting and thematic maping
- <code>dplyr</code> - Not a spatial package, but <code>sf</code> is “tidy-compliant” and we will follow “tidy” workflows in this portion of the workshop for much or our examples</p>
<p>The <a href="https://cran.r-project.org/web/views/Spatial.html">R Spatial Task View page</a> provides current and comprehensive information on the ecosystem of R packages for working with spatial data - there are hundreds out there for specific tasks - we’ll touch on several others besides core packages above this morning.</p>
</div>
</div>
<div id="quick-examples" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Quick examples</h2>
<p>Here is just a sampling of few quick spatial tasks.</p>
<div id="geocoding-example-with-tmaptools-using-open-street-map" class="section level3" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> Geocoding example with tmaptools using open street map</h3>
<p>Here we’ll use the <code>tmap</code> package and <code>tmaptools</code> to ‘geocode’ a named feature in OpenStreetMap import it into our R session as an <code>sf</code> feature.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="index.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uses OSM</span></span>
<span id="cb37-2"><a href="index.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb37-3"><a href="index.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span></code></pre></div>
<pre><code>## Warning: package &#39;tmaptools&#39; was built under R version 4.0.5</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="index.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-2"><a href="index.html#cb39-2" aria-hidden="true" tabindex="-1"></a>my_town <span class="ot">&lt;-</span>tmaptools<span class="sc">::</span><span class="fu">geocode_OSM</span>(<span class="st">&quot;Corvallis OR USA&quot;</span>, </span>
<span id="cb39-3"><a href="index.html#cb39-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">as.sf =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="index.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 9
## $ query   &lt;chr&gt; &quot;Corvallis OR USA&quot;
## $ lat     &lt;dbl&gt; 44.56457
## $ lon     &lt;dbl&gt; -123.262
## $ lat_min &lt;dbl&gt; 44.51969
## $ lat_max &lt;dbl&gt; 44.60625
## $ lon_min &lt;dbl&gt; -123.3362
## $ lon_max &lt;dbl&gt; -123.2308
## $ bbox    &lt;POLYGON [°]&gt; POLYGON ((-123.3362 44.5196...
## $ point   &lt;POINT [°]&gt; POINT (-123.262 44.56457)</code></pre>
</div>
<div id="exercise-2" class="section level3" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Exercise</h3>
<p>Run and examine code chunk above and try geocoding examples you think of</p>
<ol style="list-style-type: decimal">
<li>What is the double colon doing?</li>
<li>What is the <code>geocode_OSM</code> function doing?</li>
<li>Explain how the code runs together using the <code>%&gt;%</code> chaining operator</li>
<li>What is <code>glimpse</code>? Is it useful compared to <code>head</code> function?</li>
</ol>
</div>
<div id="solution-2" class="section level3" number="1.8.3">
<h3><span class="header-section-number">1.8.3</span> Solution</h3>
<ol style="list-style-type: decimal">
<li>It specifies using <code>geocode_OSM</code> from the <code>tmaptools</code> package. R gives namespace preference to packages in order loaded; some packages share function names; so it’s good practice to disambiguate your functions with the double-colon</li>
<li>It is looking up a named feature in OpenStreetMap and returning the coordinates (bonus - we’ll delve into more in next section - what coordinate reference system are coordinates in and how do you find out?)</li>
<li>You would translate code using the <code>&gt;%&gt;</code> operator from:</li>
</ol>
<ul>
<li>do this <code>%&gt;%</code> do that <code>%&gt;%</code> do that</li>
</ul>
<p>To</p>
<ul>
<li>do this <em>then</em> do that <em>then</em> do that</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Technically, it’s a transposed version of <code>print</code> - columns run down page, data across like rows - it additionally gives you the number of observations and variables, and the data type of each column</li>
</ol>
<ul>
<li>bonus: how would you quickly learn more about <code>glimpse</code> from the console?</li>
</ul>
</div>
<div id="choropleth-map" class="section level3" number="1.8.4">
<h3><span class="header-section-number">1.8.4</span> Choropleth map</h3>
<p>The <code>tigris</code> package can be used to get census boundaries such as states and counties as vector <code>sf</code> objects in R</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="index.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb41-2"><a href="index.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf, <span class="at">quietly =</span> T)</span>
<span id="cb41-3"><a href="index.html#cb41-3" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="st">&quot;Oregon&quot;</span>, <span class="at">cb =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-4"><a href="index.html#cb41-4" aria-hidden="true" tabindex="-1"></a>counties<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(counties))</span>
<span id="cb41-5"><a href="index.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(counties)</span>
<span id="cb41-6"><a href="index.html#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="index.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(counties) <span class="sc">+</span></span>
<span id="cb41-8"><a href="index.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">&quot;area&quot;</span>, </span>
<span id="cb41-9"><a href="index.html#cb41-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">&quot;quantile&quot;</span>, </span>
<span id="cb41-10"><a href="index.html#cb41-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">&quot;Area of Oregon Counties&quot;</span>)</span></code></pre></div>
<p><img src="R-User-Group-Spatial-Workshop-2021_files/figure-html/tmap%20example-1.png" width="768" /></p>
</div>
<div id="interactive-mapping" class="section level3" number="1.8.5">
<h3><span class="header-section-number">1.8.5</span> Interactive mapping</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="index.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb42-2"><a href="index.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(my_town, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">col.regions =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> <span class="fu">mapview</span>(counties, <span class="at">alpha.regions =</span> .<span class="dv">1</span>)</span></code></pre></div>

</div>
</div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/lesson.js"></script>
            </section>

          </div>
        </div>
      </div>

<a href="reading-in-spatial-data.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R-User-Group-Spatial-Workshop-2021.pdf", "R-User-Group-Spatial-Workshop-2021.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
